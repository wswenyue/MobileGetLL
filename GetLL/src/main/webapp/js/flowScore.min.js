function FlowScore(){this.querCreditSumPath_="/ajax/queryCreditSum.action";this.queryCreditDetailPath_="/ajax/queryCreditDetail.action?type=";this.downType_="down";this.upType_="up"}FlowScore.prototype.loadCreditSum=function(b){var a=this;$.ajax({type:"GET",url:a.querCreditSumPath_,cache:false,dataType:"json",timeout:25000,success:function(f){if(f.status!="ok"){a.showErrorResult(f);return}else{var c=f.result;var e=$("#days");if(e){e.html("流量币 | 最近"+c.days+"天 |")}var g=$("#incomeDiv");if(g){g.html(c.income)}var d=$("#expensesDiv");if(d){d.html(c.consumes)}}if(b){b(f)}},error:function(c){}})};FlowScore.prototype.loadFirstCreditDetail=function(c){var a=this;a.stop_=false;a.detailId_=0;var b=a.queryCreditDetailPath_+a.upType_+"&startNum=0";if(!a.isloading){a.isloading=true;$.ajax({type:"GET",url:b,cache:false,dataType:"json",timeout:25000,success:function(g){a.isloading=false;if(g.status!="ok"){a.showErrorResult(g,"first");return}else{var d=g.result;var f=d.list;if(f!=null&&f.length>0){var e=a.getDetailHtml(g);$("#mingxiListDiv").html(e);a.detailId_=f[f.length-1].accessId;a.stop_=false}else{a.stop_=true}}if(c){c(g)}},error:function(d){a.isloading=false}})}};FlowScore.prototype.getDetailHtml=function(g){var p=g.result;var j=p.list;var l=new Array();for(var h=0;h<j.length;h++){var f=j[h];var o="";var m="";var k=f.operImg;var n=f.operTypeId;var d=f.operResultDesc=="null"?"":f.operResultDesc;var a=f.accessType;if(a=="1"){o="myaccount_mingxi_green";m="+"}else{if(a=="2"){o="myaccount_mingxi_blue";m="-";if(n=="TIGER_GIVE"){d="投币成功"}}}if(n=="CREDIT_EXCHANGE_GIVE"){k="dh_1.png";if(f.operResult!="0"){k="dh_zs.png"}}var c="myaccount_mingxi_gray";if(f.operResult!="0"){c="myaccount_mingxi_red"}var e=f.credit;if(e=="0"||e==0){m=""}l[h]=['<div class="myaccount_mingxi_shouzhi_list">','<div class="myaccount_mingxi_shouzhi_logo"><img src="/image/'+k+'" width="60" height="60" /></div>','<div class="text_m">',"<div>"+f.operDesc+"</div>",'<div class="myaccount_mingxi_gray">'+f.accessTime+"</div>","</div>",'<div class="text_r">','<div class="'+o+'">'+m+" "+e+"</div>",'<div class="'+c+'">'+d+"</div>","</div>","</div>"].join("")}var b=l.join("");return b};FlowScore.prototype.showErrorResult=function(c,a){if(c.status!="ok"){var b=c.message;if(a=="first"){if(c.code=="EMPTY"){}else{alert(b)}}else{alert(b)}return}};FlowScore.prototype.loadNoFirstCreditDetail=function(){var a=this;var b=a.queryCreditDetailPath_+a.downType_+"&startNum="+a.detailId_+"&r="+Math.random();if(!a.stop_){if(!a.isloading){a.isloading=true;$.ajax({type:"GET",url:b,cache:false,dataType:"json",timeout:25000,success:function(f){a.isloading=false;if(f.status!="ok"){return}else{var c=f.result;var e=c.list;if(e!=null&&e.length>0){var d=a.getDetailHtml(f);$("#mingxiListDiv").append(d);a.detailId_=e[e.length-1].accessId;a.stop_=false}else{a.stop_=true}}},error:function(c){a.isloading=false}})}}};FlowScore.prototype.loadCreditDetail=function(a){var b=this;if(a=="up"){b.loadFirstCreditDetail()}else{b.loadNoFirstCreditDetail()}};FlowScore.prototype.getFlowScoreTransferGiftsInfo=function(b){var a=1;$.post("/ajax/getTransferGiftsList.action?queryType=count&type=others&status=2&r="+Math.random(),{},function(d){if(d.status!="ok"){return}else{var c=d.result;if(Number(c.totalCredit)>0){$("#receiveDiv").show();$("#totalCredit").html(c.totalCredit)}}if(b){b(d)}},"json")};FlowScore.prototype.getTotalFlow=function(b){var a=1;$.post("/ajax/getPackage.action",{},function(j){if(j.status!="ok"){showErrorResult(j);return}else{var c=j.result;$("#TotalFlowDiv").html(c.sumNumTotal);$("#LeftFlowDiv").html(c.leftNumTotal);$("#distanceDays").html(c.distDay);$("#dayNum").html(c.dayNum);var d=new Array();d.push("#e2e2e2");d.push("#feba01");var h=new Array();h.push(["已用",c.usedNumTotal]);h.push(["剩余",c.leftNumTotal]);newChart(h,d);var g=c.list;var f='<div class="jiafengge"><span class="line" style="color:#F33">套餐明细</span></div>';for(var e=0;e<g.length;e++){var k=g[e];f=[f,'<div class="myaccount_mingxi_list"><div>套餐'+getNumTip(e)+"</div>","<div>"+k.PRIVSET+"</div>",'<div><span class="detail">剩余：'+k.LEFTNUM+'M</span><span class="detail">已用：'+k.USEDNUM+"/"+k.SUMNUM+"M</span></div></div>"].join("")}$("#listDiv").html(f)}if(b){b(j)}},"json")};function showErrorResult(b){if(b.status!="ok"){var a=b.message;if(b.code=="EMPTY"){window.location.href="/"}else{alert(a)}return}}function newChart(b,a){$("#ReportDiv").highcharts({chart:{height:200},title:{text:""},tooltip:{pointFormat:"{point.percentage:.2f}%</b>"},colors:a,plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:true,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}: </b>{point.y:.2f}M"}}},credits:{enabled:false},series:[{type:"pie",data:b}]})}var flowScore=new FlowScore();